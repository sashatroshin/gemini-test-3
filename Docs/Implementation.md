# План реализации для: Онлайн-форма для отчёта по смене

## 1. Анализ функций

### Определенные функции:
- **Конфигурация через `config.json`**: Все ключевые параметры (URL вебхука, категории расходов, шаблоны сообщений) вынесены в отдельный файл.
- **Динамические поля ввода**: Поля для сумм поддерживают математические операторы (+, -) с отображением выражения в фокусе и результата после.
- **Динамическое добавление расходов**: Возможность добавлять неограниченное количество строк для фиксации расходов.
- **Логика бизнес-даты**: Автоматическая смена даты в указанное время и часовом поясе.
- **Автосохранение в `localStorage`**: Данные формы сохраняются в браузере для текущей бизнес-даты, предотвращая потерю при перезагрузке.
- **Автоматическая отправка по вебхуку**: Данные отправляются на сервер n8n через 1 минуту после последнего изменения.
- **Панель "Сводка за смену"**: В реальном времени отображает все расчетные показатели (общие расходы, ожидаемые наличные, разницы и т.д.).
- **Обработка расхождений**: Автоматическое отображение инструкций для персонала при выявлении излишков или недостач.

### Категоризация функций:
Все перечисленные функции являются **обязательными** для MVP, так как они составляют основу требуемого рабочего процесса.

## 2. Рекомендуемый технологический стек

### Фронтенд:
- **Технология:** Vanilla JavaScript (ES6+), HTML5, CSS3.
- **Обоснование:** PRD описывает одностраничное приложение с ограниченной сложностью состояния. Использование нативных технологий без фреймворков обеспечит максимальную производительность, быструю загрузку и простоту развертывания на любой статической платформе хостинга.
- **Документация:** [MDN Web Docs](https://developer.mozilla.org/ru/docs/Web/JavaScript)

### Инструменты сборки и развертывания:
- **Развертывание:** Easypanel (согласно PRD).
- **Обоснование:** Платформа выбрана заказчиком для упрощения процесса развертывания.
- **Документация:** [Easypanel Docs](https://easypanel.io/docs)

### Дополнительные инструменты:
- **Работа с датами:** `date-fns-tz`
- **Обоснование:** Небольшая, но мощная библиотека для надежной работы с датами и часовыми поясами, что критично для логики "бизнес-даты".
- **Документация:** [date-fns-tz Docs](https://github.com/marnusw/date-fns-tz)

## 3. Этапы реализации

### Этап 1: Основа и настройка
**Продолжительность:** 1-2 дня
**Зависимости:** Нет

#### Подэтапы:
- [ ] Настроить среду разработки.
- [ ] Инициализировать структуру проекта (`index.html`, `style.css`, `app.js`, `config.json`).
- [ ] Создать базовую разметку HTML с двумя колонками и всеми статичными полями ввода.
- [ ] Подключить базовые стили для создания минималистичного и чистого интерфейса.

### Этап 2: Основная логика
**Продолжительность:** 2-3 дня
**Зависимости:** Завершение этапа 1

#### Подэтапы:
- [ ] Реализовать загрузку и парсинг `config.json`.
- [ ] Реализовать логику определения и смены "бизнес-даты" с использованием `date-fns-tz`.
- [ ] Реализовать автосохранение всех вводимых данных в `localStorage` с привязкой к бизнес-дате.
- [ ] Реализовать восстановление данных из `localStorage` при загрузке страницы.

### Этап 3: Реализация интерактивных функций
**Продолжительность:** 3-4 дня
**Зависимости:** Завершение этапа 2

#### Подэтапы:
- [ ] Реализовать функциональность "Добавить расход" с динамическим созданием полей.
- [ ] Реализовать вычисление математических выражений в полях ввода сумм.
- [ ] Настроить все расчеты для панели "Сводка за смену" и обеспечить их обновление в реальном времени.
- [ ] Реализовать логику отображения сообщений об излишках/недостачах на основе расчетных разниц.

### Этап 4: Интеграция и завершение
**Продолжительность:** 1-2 дня
**Зависимости:** Завершение этапа 3

#### Подэтапы:
- [ ] Реализовать логику отложенной отправки данных на вебхук (debounce 1 минута).
- [ ] Сформировать и отправить JSON-объект в формате, указанном в PRD.
- [ ] Провести комплексное ручное тестирование всех функций.
- [ ] Подготовить и задокументировать процесс развертывания на Easypanel.
- [ ] Провести финальную стилизацию и проверку адаптивности интерфейса.

## 4. Ссылки на ресурсы
- [MDN Web Docs (JavaScript)](https://developer.mozilla.org/ru/docs/Web/JavaScript)
- [date-fns-tz Documentation](https://github.com/marnusw/date-fns-tz)
- [Easypanel Documentation](https://easypanel.io/docs)
