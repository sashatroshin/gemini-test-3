# План реализации для "Онлайн-форма для отчёта по смене"

## Анализ функций
### Определенные функции:
- **Конфигурация через `config.json`:** Все ключевые параметры (URL вебхука, время смены бизнес-даты, категории расходов, шаблоны сообщений) вынесены во внешний файл.
- **Динамические поля ввода:** Поля для сумм поддерживают ввод математических выражений (`+`, `-`) и отображают результат при потере фокуса.
- **Управление расходами:** Возможность динамически добавлять неограниченное количество записей о расходах.
- **Автоматические расчеты:** Все итоговые значения в сводке ("Сводка за смену") пересчитываются в реальном времени при изменении данных.
- **Обработка расхождений:** Система автоматически анализирует разницы по наличным и безналу и выводит соответствующие инструкции для персонала.
- **Логика бизнес-даты:** Дата автоматически обновляется в указанное в `config.json` время и часовом поясе.
- **Автосохранение в `localStorage`:** Данные формы сохраняются в локальном хранилище браузера и восстанавливаются при перезагрузке, привязываясь к текущей бизнес-дате.
- **Отправка данных по вебхуку:** Форма автоматически отправляет итоговый JSON на указанный URL через 1 минуту после последнего изменения.

### Категоризация функций:
Все перечисленные функции являются **обязательными** для выполнения ключевых задач продукта, описанных в PRD.

## Рекомендуемый технологический стек
### Фронтенд:
- **Фреймворк:** Vanilla JavaScript (ES6+) - Для данного проекта не требуются тяжелые фреймворки. Чистый JS обеспечит максимальную производительность и простоту, что полностью соответствует требованиям PRD.
- **Документация:** [MDN Web Docs: JavaScript](https://developer.mozilla.org/ru/docs/Web/JavaScript)
- **Стилизация:** CSS3 (Flexbox/Grid) - Для создания адаптивной двухколоночной структуры и минималистичного дизайна.
- **Документация:** [MDN Web Docs: CSS](https://developer.mozilla.org/ru/docs/Web/CSS)
- **Структура:** HTML5 - Семантическая верстка для лучшей структуры и доступности.
- **Документация:** [MDN Web Docs: HTML](https://developer.mozilla.org/ru/docs/Web/HTML)

### Дополнительные инструменты:
- **Развертывание:** Git + Easypanel - Как указано в PRD, код будет храниться на GitHub и развертываться через Easypanel.
- **Документация:** [Easypanel Docs](https://easypanel.io/docs/)

## Этапы реализации

### Этап 1: Основа и настройка
**Продолжительность:** ~4 часа
**Зависимости:** Нет

#### Подэтапы:
- [ ] Создать структуру проекта: `index.html`, `style.css`, `script.js`, `config.json`.
- [ ] Инициализировать Git-репозиторий и сделать первый коммит.
- [ ] Настроить базовую HTML-разметку с двухколоночной структурой (область ввода и сводка).
- [ ] Подключить стили и скрипты к `index.html`.
- [ ] Реализовать загрузку и парсинг `config.json` при старте приложения.
- [ ] Сверстать все статические поля ввода и кнопки согласно PRD.

### Этап 2: Основные функции и логика расчетов
**Продолжительность:** ~8-10 часов
**Зависимости:** Завершение этапа 1

#### Подэтапы:
- [ ] Реализовать логику вычисления математических выражений в полях ввода.
- [ ] Реализовать функцию добавления/удаления полей для расходов.
- [ ] Написать функцию, которая собирает все данные из полей формы в единый объект.
- [ ] Реализовать все расчеты для блока "Сводка за смену" (`obschie_rashodi`, `ozhidaemie_nalichnie` и т.д.).
- [ ] Настроить обновление сводки в реальном времени при изменении любого поля ввода.
- [ ] Реализовать логику отображения сообщений о расхождениях (`cashSurplus`, `cashShortage` и т.д.) с форматированием суммы.

### Этап 3: Сохранение данных и интеграция
**Продолжительность:** ~6-8 часов
**Зависимости:** Завершение этапа 2

#### Подэтапы:
- [ ] Реализовать функцию определения текущей бизнес-даты на основе `config.json`.
- [ ] Реализовать сохранение данных формы в `localStorage` с ключом, включающим текущую бизнес-дату.
- [ ] Реализовать восстановление данных из `localStorage` при загрузке страницы.
- [ ] Написать функцию для формирования итогового JSON-объекта в формате, указанном в PRD.
- [ ] Реализовать отложенную отправку данных (debounce) на `webhookUrl` через 1 минуту после последнего изменения.
- [ ] Добавить визуальный индикатор статуса отправки (например, "Сохранение...", "Сохранено").

### Этап 4: Доработка и оптимизация
**Продолжительность:** ~4-6 часов
**Зависимости:** Завершение этапа 3

#### Подэтапы:
- [ ] Провести финальную стилизацию интерфейса для соответствия "стильному, современному, минималистичному" виду.
- [ ] Провести комплексное тестирование всех функций: расчеты, сохранение, отправка, обработка расхождений.
- [ ] Проверить кроссбраузерную совместимость (Chrome, Firefox, Safari).
- [ ] Оптимизировать код, добавить комментарии к сложным участкам.
- [ ] Подготовить `README.md` с инструкциями по настройке и запуску.
- [ ] Провести тестовое развертывание на Easypanel.

## Ссылки на ресурсы
- [MDN Web Docs: JavaScript](https://developer.mozilla.org/ru/docs/Web/JavaScript)
- [MDN Web Docs: Fetch API (для вебхука)](https://developer.mozilla.org/ru/docs/Web/API/Fetch_API)
- [MDN Web Docs: Web Storage API (для localStorage)](https://developer.mozilla.org/ru/docs/Web/API/Web_Storage_API)
- [A Complete Guide to Flexbox](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)
