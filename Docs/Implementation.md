# План реализации для: Онлайн-форма для отчёта по смене

## Анализ функций
### Определенные функции:
- **Конфигурация через `config.json`:** Все ключевые параметры (URL вебхука, категории расходов, сообщения) настраиваются в одном файле.
- **Динамический ввод данных:** Поля ввода поддерживают оператор `+` для быстрых расчетов на лету.
- **Динамическое добавление расходов:** Возможность добавлять неограниченное количество строк для учета расходов.
- **Автоматические расчеты в реальном времени:** Правая колонка "Сводка за смену" мгновенно обновляется при изменении данных.
- **Обработка расхождений:** Автоматическое отображение инструкций для персонала при недостаче или излишке наличных и безналичных средств.
- **Автосохранение:** Данные сохраняются в `localStorage` для текущей бизнес-даты, предотвращая потерю при перезагрузке.
- **Автоматическая смена бизнес-даты:** Дата меняется в указанное в конфиге время, с последующей перезагрузкой страницы.
- **Отправка данных по вебхуку:** Автоматическая отправка отчета в формате JSON на указанный URL через 1 минуту после последнего изменения.

### Категоризация функций:
- **Обязательные функции:** Все перечисленные выше функции являются обязательными для выполнения основных задач продукта.
- **Желательные функции:** Нет.
- **Необязательные функции:** Нет.

## Рекомендуемый технологический стек
### Фронтенд:
- **Фреймворк:** Vanilla JavaScript (ES6+) - Учитывая, что это одностраничное приложение с четко определенной логикой, использование полноценного фреймворка (React, Vue) избыточно. Vanilla JS обеспечит максимальную производительность и простоту развертывания.
- **Документация:** [MDN Web Docs for JavaScript](https://developer.mozilla.org/en-US/docs/Web/JavaScript)
- **Стилизация:** Pico.css - Легковесный CSS-фреймворк для придания семантическому HTML стильного и современного вида с минимальными усилиями. Это идеально соответствует требованию "стильный, современный, минималистичный".
- **Документация:** [Pico.css Docs](https://picocss.com/docs/)

### Бэкенд:
- **Технология:** n8n (для получения вебхука) - Система уже определена в PRD. На стороне приложения бэкенд не требуется.
- **Документация:** [n8n Docs](httpss://docs.n8n.io/)

### База данных:
- **Технология:** `localStorage` браузера - Для реализации функции автосохранения данных на стороне клиента. Полноценная база данных не требуется.
- **Документация:** [MDN Web Docs for localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage)

### Дополнительные инструменты:
- **Хостинг:** GitHub Pages - Бесплатный и простой хостинг для статических сайтов, идеально подходит для данного проекта.
- **Документация:** [GitHub Pages Docs](https://docs.github.com/en/pages)

## Этапы реализации

### Этап 1: Основа и настройка
**Продолжительность:** 1-2 часа
**Зависимости:** Нет

#### Подэтапы:
- [x] Инициализировать структуру проекта (`index.html`, `css/style.css`, `js/app.js`, `config.json`).
- [x] Подключить Pico.css и базово настроить стили.
- [x] Создать базовую HTML-разметку с двумя колонками и всеми статичными полями ввода.
- [x] Написать скрипт для загрузки и парсинга `config.json` при старте приложения.

### Этап 2: Реализация основного интерфейса и логики
**Продолжительность:** 3-4 часа
**Зависимости:** Завершение этапа 1

#### Подэтапы:
- [x] Реализовать логику вычисления выражений с `+` в полях ввода.
- [x] Реализовать динамическое добавление и удаление полей для расходов.
- [x] Заполнить выпадающий список категорий расходов данными из `config.json`.
- [x] Реализовать все расчеты для "Сводки за смену" и отображение результатов.
- [x] Настроить автосохранение всех вводимых данных в `localStorage` при каждом изменении.
- [x] Реализовать восстановление данных из `localStorage` при загрузке страницы для текущей бизнес-даты.

### Этап 3: Расширенные функции и интеграция
**Продолжительность:** 2-3 часа
**Зависимости:** Завершение этапа 2

#### Подэтапы:
- [x] Реализовать логику определения бизнес-даты на основе `config.json`.
- [x] Добавить проверку актуальности бизнес-даты при изменении данных и перезагрузку страницы при необходимости.
- [x] Реализовать логику отображения сообщений о расхождениях (`cashSurplus`, `cashShortage` и т.д.).
- [x] Реализовать функцию сборки и отправки JSON-объекта на `webhookUrl`.
- [x] Настроить таймер для отправки вебхука (1 минута после последнего изменения).

### Этап 4: Доработка и тестирование
**Продолжительность:** 2 часа
**Зависимости:** Завершение этапа 3

#### Подэтапы:
- [ ] Провести комплексное ручное тестирование всех функций.
- [ ] Проверить валидацию полей (например, ввод букв в числовые поля).
- [ ] Оптимизировать код и улучшить комментарии.
- [ ] Подготовить репозиторий для развертывания на GitHub Pages.

## Ссылки на ресурсы
- **JavaScript:** [MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/JavaScript)
- **Pico.css:** [Official Documentation](https://picocss.com/docs/)
- **GitHub Pages:** [Setup Guide](https://docs.github.com/en/pages)
- **n8n Webhooks:** [Webhook Documentation](https://docs.n8n.io/integrations/core-nodes/n8n-nodes-base.webhook/)
